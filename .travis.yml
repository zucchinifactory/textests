language: generic
before_install:
  - |
    if [ "$TRAVIS_EVENT_TYPE" == "push" ] && [ "$TRAVIS_TAG" == "" ] && [[ $TRAVIS_COMMIT_MESSAGE == *"[ci autotag]"* ]]; then
      echo "Cancel build #$TRAVIS_BUILD_NUMBER and push tag to trigger new build and release deployment instead."
      git config --global user.email "deploy@travis-ci.org"
      git config --global user.name "Deployment Bot (from Travis CI)"
      export GIT_TAG=${TRAVIS_BRANCH}_$(date --utc "+%Y-%m-%d-%H-%M-%S")
      git tag "$GIT_TAG" -a -m "This tag has been auto-generated by Travis CI build #$TRAVIS_BUILD_NUMBER."
      git push "https://$GITHUB_TOKEN@github.com/$TRAVIS_REPO_SLUG" "$GIT_TAG"
      gem install travis
      travis login --org --github-token $GITHUB_TOKEN
      travis cancel $TRAVIS_BUILD_NUMBER
      sleep infinity
    fi
  - sudo apt-get -qq update
  - sudo apt-get install -qq -y texlive-latex-extra texlive-fonts-recommended texlive-fonts-extra latexmk
script:
  - make
deploy:
  - provider: releases
    skip_cleanup: true
    api_key: $GITHUB_TOKEN
    file_glob: true
    file:
      - "*.pdf"
    on:
      tags: true
